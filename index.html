<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆë¹„ë…¸ê¸° ë£¬ & ë ˆì´ë“œ ë§¤ë‹ˆì € (ìˆ˜ì •ê¸°ëŠ¥ ì¶”ê°€)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #F3F4F6; color: #1F2937; }
        
        /* Rune Rank Colors */
        .rank-SSS { background: linear-gradient(135deg, #fde047, #f59e0b); color: #422006; border: 2px solid #ca8a04; }
        .rank-SS { background: linear-gradient(135deg, #d1d5db, #9ca3af); color: #1f2937; border: 2px solid #6b7280; }
        .rank-S { background-color: #EC4899; color: white; }
        .rank-A-Plus { background-color: #8B5CF6; color: white; }
        .rank-A { background-color: #3B82F6; color: white; }
        .rank-B { background-color: #22C55E; color: white; }
        .rank-C { background-color: #F97316; color: white; }
        .rank-F { background-color: #6B7280; color: white; }
        .rank-TBD { background-color: #e5e7eb; color: #4b5563; }

        .type-ë¬´ê¸° { background-color: #DC2626; color: white; }
        .type-ë°©ì–´êµ¬ { background-color: #059669; color: white; }
        .type-ì— ë¸”ëŸ¼ { background-color: #7e22ce; color: white; }
        .grade-ì‹ í™” { border-color: #8B5CF6; color: #8B5CF6; }
        .grade-ì „ì„¤ { border-color: #FBBF24; color: #FBBF24; }
        
        /* Raid Planner Styles */
        .role-tank { background-color: #fee2e2; color: #991b1b; }
        .role-dealer { background-color: #e0f2fe; color: #075985; }
        .role-healer { background-color: #dcfce7; color: #166534; }
        .role-support { background-color: #f3e8ff; color: #6b21a8; }

        .tab-active { border-bottom: 2px solid #4F46E5; color: #4F46E5; font-weight: 700; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #6B7280; cursor: pointer; }
        .tab-inactive:hover { color: #374151; border-bottom: 2px solid #D1D5DB; }
        
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #3498db; width: 20px; height: 20px; -webkit-animation: spin 1s linear infinite; animation: spin 1s linear infinite; }
        @-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); } 100% { -webkit-transform: rotate(360deg); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Navigation Tabs -->
    <nav class="bg-white shadow sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <h1 class="text-xl font-bold text-gray-900 mr-8">ë§ˆë¹„ë…¸ê¸° ëª¨ë°”ì¼ ë§¤ë‹ˆì €</h1>
                    </div>
                    <div class="flex space-x-8">
                        <button id="tab-rune" class="tab-active inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors">
                            ë£¬ ë„ê°
                        </button>
                        <button id="tab-raid" class="tab-inactive inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors">
                            ë ˆì´ë“œ íŒŒí‹° êµ¬ì„± (8ì¸)
                        </button>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                     <span id="connection-status" class="text-xs text-green-600 font-bold flex items-center hidden">
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>DB ì—°ë™ë¨
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl flex-grow">
        
        <!-- ==================== SECTION 1: RUNE BROWSER ==================== -->
        <div id="section-rune-browser" class="block">
            <section id="controls" class="mb-8 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-7 gap-4 items-end">
                    <div class="lg:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ê²€ìƒ‰</label>
                        <input type="text" id="search-input" placeholder="ë£¬ ì´ë¦„, ì§ì—…ëª…(ì˜ˆ: ê²€ìˆ ì‚¬)" class="block w-full rounded-md border border-gray-300 p-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">í´ë˜ìŠ¤</label>
                        <select id="class-filter" class="block w-full rounded-md border border-gray-300 p-2 text-sm"><option value="all">ì „ì²´ í´ë˜ìŠ¤</option></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ë“±ê¸‰</label>
                        <select id="grade-filter" class="block w-full rounded-md border border-gray-300 p-2 text-sm"><option value="all">ì „ì²´ ë“±ê¸‰</option></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì¢…ë¥˜</label>
                        <select id="type-filter" class="block w-full rounded-md border border-gray-300 p-2 text-sm"><option value="all">ì „ì²´ ì¢…ë¥˜</option></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ë­í¬</label>
                        <select id="rank-filter" class="block w-full rounded-md border border-gray-300 p-2 text-sm"><option value="all">ì „ì²´ ë­í¬</option></select>
                    </div>
                    <button id="reset-filters" class="w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 transition shadow-sm">ì´ˆê¸°í™”</button>
                </div>
            </section>
            <div class="mb-4 text-right text-gray-500 text-sm">
                ê²€ìƒ‰ëœ ë£¬: <span id="rune-count" class="font-bold text-indigo-600">0</span>ê°œ
            </div>
            <section id="rune-grid" class="space-y-4"></section>
        </div>

        <!-- ==================== SECTION 2: RAID BUILDER ==================== -->
        <div id="section-raid-builder" class="hidden">
            <header class="mb-6 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">ì‹¤ì‹œê°„ ë ˆì´ë“œ íŒŒí‹° êµ¬ì„± (8ì¸)</h2>
                    <p class="text-gray-600 text-sm">ììœ ë¡­ê²Œ ê¸¸ë“œì›ì„ ë“±ë¡í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </header>

            <div class="grid grid-cols-1 xl:grid-cols-12 gap-6">
                <!-- Left: Roster -->
                <div class="xl:col-span-3 space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 relative">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2" id="form-title">ê¸¸ë“œì› ë“±ë¡</h3>
                        <div class="space-y-4">
                            <input type="hidden" id="edit-member-id">
                            <div>
                                <label class="block text-xs font-medium text-gray-500">ì´ë¦„</label>
                                <input type="text" id="member-name" class="w-full rounded-md border border-gray-300 p-2" placeholder="ì˜ˆ: ì¹´ì—”">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-500">ì§ì—…</label>
                                <select id="member-class-select" class="w-full rounded-md border border-gray-300 p-2"></select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-500">ì „íˆ¬ë ¥</label>
                                <input type="number" id="member-cp" class="w-full rounded-md border border-gray-300 p-2" placeholder="ì˜ˆ: 15000">
                            </div>
                            <div class="flex gap-2">
                                <button id="save-member-btn" class="flex-1 bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition">ë“±ë¡í•˜ê¸°</button>
                                <button id="cancel-edit-btn" class="hidden flex-none bg-gray-400 text-white py-2 px-4 rounded-md hover:bg-gray-500 transition">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-center mb-4 border-b pb-2">
                            <h3 class="text-lg font-bold text-gray-800">ëŒ€ê¸° ëª…ë‹¨ (<span id="roster-count">0</span>)</h3>
                            <button id="clear-roster-btn" class="text-xs text-red-500 hover:text-red-700 underline">ì „ì²´ ì‚­ì œ</button>
                        </div>
                        <div id="roster-list" class="space-y-2 max-h-[600px] overflow-y-auto pr-2 min-h-[100px]">
                            <div class="flex justify-center items-center py-4"><div class="loader"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Right: Parties -->
                <div class="xl:col-span-9 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Party 1 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden h-fit">
                        <div class="bg-blue-600 px-6 py-3 flex justify-between items-center text-white">
                            <h3 class="font-bold text-lg">1íŒŒí‹°</h3>
                            <div class="text-sm opacity-90">í‰ê·  CP: <span id="p1-avg-cp">0</span> | <span id="p1-count">0</span>/8</div>
                        </div>
                        <div class="p-0">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 w-10">No</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ì´ë¦„</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ì—­í•  / CP</th>
                                        <th class="px-4 py-2 text-right text-xs font-medium text-gray-500">ê´€ë¦¬</th>
                                    </tr>
                                </thead>
                                <tbody id="party1-list" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                        <div class="p-2 bg-gray-50 text-right">
                            <button id="clear-p1-btn" class="text-xs text-red-500 hover:text-red-700">1íŒŒí‹° ë¹„ìš°ê¸°</button>
                        </div>
                    </div>

                    <!-- Party 2 -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden h-fit">
                        <div class="bg-green-600 px-6 py-3 flex justify-between items-center text-white">
                            <h3 class="font-bold text-lg">2íŒŒí‹°</h3>
                            <div class="text-sm opacity-90">í‰ê·  CP: <span id="p2-avg-cp">0</span> | <span id="p2-count">0</span>/8</div>
                        </div>
                        <div class="p-0">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 w-10">No</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ì´ë¦„</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ì—­í•  / CP</th>
                                        <th class="px-4 py-2 text-right text-xs font-medium text-gray-500">ê´€ë¦¬</th>
                                    </tr>
                                </thead>
                                <tbody id="party2-list" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                        <div class="p-2 bg-gray-50 text-right">
                            <button id="clear-p2-btn" class="text-xs text-red-500 hover:text-red-700">2íŒŒí‹° ë¹„ìš°ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, setDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCRjsQfmOvpPRkgtlCRj99NXf1V6J_vqLY",
            authDomain: "raid-magicianking.firebaseapp.com",
            projectId: "raid-magicianking",
            storageBucket: "raid-magicianking.firebasestorage.app",
            messagingSenderId: "619923544800",
            appId: "1:619923544800:web:af511807cda0c779e1ce85"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentRoster = [];
        let currentParty1 = Array(8).fill(null);
        let currentParty2 = Array(8).fill(null);

        function formatNumber(num) { return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
        function getRoleStyle(className) {
            if (className.includes('íëŸ¬') || className.includes('ì‚¬ì œ')) return 'role-healer';
            if (className.includes('ì „ì‚¬') || className.includes('ê²€ìˆ ì‚¬') || className.includes('ê²©íˆ¬ê°€') || className.includes('ë“€ì–¼') || className.includes('ë„ì ') || className.includes('ìˆ˜ë„ì‚¬')) return 'role-dealer';
            if (className.includes('ìŒìœ ') || className.includes('ì•…ì‚¬') || className.includes('ëŒ„ì„œ')) return 'role-support';
            return 'role-dealer'; 
        }

        // Global Actions
        window.deleteRosterMember = async (id) => {
            if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) await deleteDoc(doc(db, "roster", id));
        };

        // NEW: Edit Functionality
        window.editRosterMember = (id, name, job, cp) => {
            document.getElementById('form-title').textContent = 'ê¸¸ë“œì› ì •ë³´ ìˆ˜ì •';
            document.getElementById('edit-member-id').value = id;
            document.getElementById('member-name').value = name;
            document.getElementById('member-class-select').value = job;
            document.getElementById('member-cp').value = cp;
            
            const saveBtn = document.getElementById('save-member-btn');
            saveBtn.textContent = 'ìˆ˜ì • ì™„ë£Œ';
            saveBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
            saveBtn.classList.add('bg-amber-600', 'hover:bg-amber-700');
            
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
        };

        // Cancel Edit
        document.getElementById('cancel-edit-btn').addEventListener('click', () => {
            resetForm();
        });

        function resetForm() {
            document.getElementById('form-title').textContent = 'ê¸¸ë“œì› ë“±ë¡';
            document.getElementById('edit-member-id').value = '';
            document.getElementById('member-name').value = '';
            document.getElementById('member-cp').value = '';
            
            const saveBtn = document.getElementById('save-member-btn');
            saveBtn.textContent = 'ë“±ë¡í•˜ê¸°';
            saveBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            saveBtn.classList.remove('bg-amber-600', 'hover:bg-amber-700');
            
            document.getElementById('cancel-edit-btn').classList.add('hidden');
        }

        window.moveToParty = async (partyNum, memberId) => {
            const member = currentRoster.find(m => m.id === memberId);
            if (!member) return;

            const targetParty = partyNum === 1 ? currentParty1 : currentParty2;
            const emptyIdx = targetParty.findIndex(slot => slot === null);

            if (emptyIdx === -1) {
                alert(`${partyNum}íŒŒí‹°ê°€ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.`);
                return;
            }

            const newParty = [...targetParty];
            newParty[emptyIdx] = member;
            
            const partyRef = doc(db, "raid", "current_session");
            const updatePayload = partyNum === 1 ? { party1: newParty } : { party2: newParty };
            await updateDoc(partyRef, updatePayload);
        };

        window.removePartyMember = async (partyNum, idx) => {
            const targetParty = partyNum === 1 ? [...currentParty1] : [...currentParty2];
            targetParty[idx] = null;
            const partyRef = doc(db, "raid", "current_session");
            const updatePayload = partyNum === 1 ? { party1: targetParty } : { party2: targetParty };
            await updateDoc(partyRef, updatePayload);
        };

        window.clearParty = async (partyNum) => {
            if(confirm(`${partyNum}íŒŒí‹°ë¥¼ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const emptyParty = Array(8).fill(null);
                const partyRef = doc(db, "raid", "current_session");
                const updatePayload = partyNum === 1 ? { party1: emptyParty } : { party2: emptyParty };
                await updateDoc(partyRef, updatePayload);
            }
        };

        window.clearAllRoster = async () => {
             if(confirm("ëŒ€ê¸° ëª…ë‹¨ ì „ì²´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                // Warning: Only manual deletion in free tier safety
                alert("ë°ì´í„° ì•ˆì „ì„ ìœ„í•´ ê°œë³„ ì‚­ì œë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.");
             }
        }

        // Rendering
        function renderRosterUI(rosterData) {
            const list = document.getElementById('roster-list');
            document.getElementById('roster-count').textContent = rosterData.length;
            list.innerHTML = '';

            if (rosterData.length === 0) {
                list.innerHTML = '<p class="text-sm text-gray-500 text-center py-4">ë“±ë¡ëœ ê¸¸ë“œì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            rosterData.forEach(member => {
                const div = document.createElement('div');
                div.className = "flex justify-between items-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition";
                div.innerHTML = `
                    <div class="flex-1">
                        <div class="flex items-center">
                            <span class="font-bold text-gray-800">${member.name}</span>
                            <button onclick="editRosterMember('${member.id}', '${member.name}', '${member.job}', ${member.cp})" class="ml-2 text-xs text-gray-400 hover:text-indigo-600">âœï¸</button>
                        </div>
                        <span class="text-xs text-gray-500">${member.job}</span>
                        <span class="text-xs font-mono text-indigo-600 ml-2">CP ${formatNumber(member.cp)}</span>
                    </div>
                    <div class="space-x-1 flex">
                        <button onclick="moveToParty(1, '${member.id}')" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold">1</button>
                        <button onclick="moveToParty(2, '${member.id}')" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200 font-bold">2</button>
                        <button onclick="deleteRosterMember('${member.id}')" class="text-xs text-red-400 hover:text-red-600 ml-1 p-1">ğŸ—‘ï¸</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function renderPartyUI(partyData, partyNum) {
            const tbody = document.getElementById(`party${partyNum}-list`);
            tbody.innerHTML = '';
            let totalCp = 0;
            let count = 0;

            partyData.forEach((member, idx) => {
                const tr = document.createElement('tr');
                if (member) {
                    totalCp += parseInt(member.cp);
                    count++;
                    tr.innerHTML = `
                        <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${idx + 1}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-800 font-bold">${member.name}</td>
                        <td class="px-4 py-2 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getRoleStyle(member.job)}">${member.job}</span>
                            <span class="text-xs text-gray-500 ml-1 font-mono">${formatNumber(member.cp)}</span>
                        </td>
                        <td class="px-4 py-2 whitespace-nowrap text-right text-sm font-medium">
                            <button onclick="removePartyMember(${partyNum}, ${idx})" class="text-red-600 hover:text-red-900">ë¹¼ê¸°</button>
                        </td>
                    `;
                } else {
                    tr.innerHTML = `
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400">${idx + 1}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400 italic">ë¹ˆ ìŠ¬ë¡¯</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400">-</td>
                        <td class="px-4 py-2 whitespace-nowrap text-right text-sm font-medium">-</td>
                    `;
                }
                tbody.appendChild(tr);
            });

            const avg = count > 0 ? Math.round(totalCp / count) : 0;
            document.getElementById(`p${partyNum}-avg-cp`).textContent = formatNumber(avg);
            document.getElementById(`p${partyNum}-count`).textContent = count;
        }

        // Initialization
        const rosterQuery = query(collection(db, "roster"), orderBy("cp", "desc"));
        onSnapshot(rosterQuery, (snapshot) => {
            currentRoster = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderRosterUI(currentRoster);
            document.getElementById('connection-status').classList.remove('hidden');
        });

        const partyRef = doc(db, "raid", "current_session");
        onSnapshot(partyRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                currentParty1 = data.party1 && data.party1.length === 8 ? data.party1 : Array(8).fill(null);
                currentParty2 = data.party2 && data.party2.length === 8 ? data.party2 : Array(8).fill(null);
            } else {
                setDoc(partyRef, { party1: Array(8).fill(null), party2: Array(8).fill(null) });
            }
            renderPartyUI(currentParty1, 1);
            renderPartyUI(currentParty2, 2);
        });

        // Handle Save (Add or Update)
        document.getElementById('save-member-btn').addEventListener('click', async () => {
            const id = document.getElementById('edit-member-id').value;
            const name = document.getElementById('member-name').value;
            const job = document.getElementById('member-class-select').value;
            const cp = document.getElementById('member-cp').value;

            if (name && cp) {
                if (id) {
                    // Update existing
                    await updateDoc(doc(db, "roster", id), {
                        name, job, cp: parseInt(cp), timestamp: serverTimestamp()
                    });
                } else {
                    // Add new
                    await addDoc(collection(db, "roster"), { 
                        name, job, cp: parseInt(cp), timestamp: serverTimestamp() 
                    });
                }
                resetForm();
            } else {
                alert('ì´ë¦„ê³¼ ì „íˆ¬ë ¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        });

        document.getElementById('clear-p1-btn').addEventListener('click', () => window.clearParty(1));
        document.getElementById('clear-p2-btn').addEventListener('click', () => window.clearParty(2));
        document.getElementById('clear-roster-btn').addEventListener('click', () => window.clearAllRoster());

        // Populate Select
        const classList = [
            "ì „ì‚¬ (ê²€ë°©)", "ì „ì‚¬ (ëŒ€ê²€)", "ê²€ìˆ ì‚¬", 
            "ê¶ìˆ˜", "ì„ê¶ì‚¬ìˆ˜", "ì¥ê¶ë³‘", 
            "ë§ˆë²•ì‚¬", "í™”ì—¼ìˆ ì‚¬", "ë¹™ê²°ìˆ ì‚¬", "ì „ê²©ìˆ ì‚¬", 
            "íëŸ¬", "ì‚¬ì œ", "ìˆ˜ë„ì‚¬", 
            "ì•”í‘ìˆ ì‚¬", "ìŒìœ ì‹œì¸", "ì•…ì‚¬", "ëŒ„ì„œ", 
            "ë„ì ", "ê²©íˆ¬ê°€", "ë“€ì–¼ ë¸”ë ˆì´ë“œ"
        ].sort();
        
        const memberClassSelect = document.getElementById('member-class-select');
        if(memberClassSelect) {
            classList.forEach(c => {
                const opt = document.createElement('option'); opt.value = c; opt.textContent = c; memberClassSelect.appendChild(opt);
            });
        }
    </script>

    <!-- Rune Data Script -->
    <script>
        // (Rune Data and Rendering Logic - Copied from verified version)
        const runeData = [
            { "name": "ì°½ë°±í•œ ì„¬ê´‘", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "SSS", "description": "ê³µê²© ì‹œ, ì¹˜ëª…íƒ€ í™•ë¥ ì´ 15ì´ˆ ë™ì•ˆ 8/10% ì¦ê°€í•œë‹¤. ë³´ìœ í•œ ëª¨ë“  ì¶©ì „ì„ ì „ë ¥ìœ¼ë¡œ ë³€í™˜í•˜ê³ , ë³€í™˜ëœ ì „ë ¥ ìˆ˜ì¹˜ Ã— 0.09%ë§Œí¼ ì¹˜ëª…íƒ€ í™•ë¥ ì´ ì¶”ê°€ë¡œ ì¦ê°€í•œë‹¤.(ì¬ì‚¬ìš© ëŒ€ê¸° ì‹œê°„: 15ì´ˆ) 50ì´ìƒì˜ ì „ë ¥ì„ ë³´ìœ í•œ ìƒíƒœì—ì„œ ê°ì„± í˜¹ì€ ê¶ê·¹ê¸° ì‚¬ìš© ì‹œ, ê³¼ë¶€í•˜ ìƒíƒœê°€ ëœë‹¤. ì¹˜ëª…íƒ€ í”¼í•´ê°€ 32% ì¦ê°€í•˜ë©°, 1ì´ˆë§ˆë‹¤ 50ì˜ ì „ë ¥ì„ ì†Œëª¨í•œë‹¤. ì „ë ¥ì´ 50 ë¯¸ë§Œì´ ë  ê²½ìš°, ì¦‰ì‹œ ê³¼ë¶€í•˜ê°€ ì¢…ë£Œëœë‹¤.", "analysis": "<strong>[ë§Œì¥ì¼ì¹˜ ì¶”ì²œ]</strong> <span class='text-blue-600'>[ìƒˆí¬ë¦¬ë§ˆ]</span> ì´ê²¬ ì—†ëŠ” ê°œì‚¬ê¸°. ì¹˜ëª…íƒ€ í™•ë¥ ê³¼ í”¼í•´ëŸ‰ì„ ë™ì‹œì— ì±™ê²¨ 'ë“¤ë¶ˆ'ì„ ì••ë„í•¨.<br><span class='text-purple-600'>[1íƒ€ë²•ì‚¬]</span> ë„˜ì‚¬ë²½ì˜ ì„±ëŠ¥ ì°¨ì´. 'ì•„ë“í•œ ë¹›' ì— ë¸”ëŸ¼ê³¼ ì‚¬ìš© ì‹œ ì¢…ê²° ì„¸íŒ….", "recommendedClasses": ["ì „ì‚¬ (ê²€ë°©)", "ì „ì‚¬ (ëŒ€ê²€)", "ê²€ìˆ ì‚¬", "ê¶ìˆ˜", "ì„ê¶ì‚¬ìˆ˜", "ì¥ê¶ë³‘", "ë§ˆë²•ì‚¬", "í™”ì—¼ìˆ ì‚¬", "ë¹™ê²°ìˆ ì‚¬", "ì „ê²©ìˆ ì‚¬", "ì•”í‘ìˆ ì‚¬", "ìŒìœ ì‹œì¸", "ì•…ì‚¬", "ëŒ„ì„œ", "ë„ì ", "ê²©íˆ¬ê°€", "ë“€ì–¼ ë¸”ë ˆì´ë“œ"] },
            // ... (ì „ì²´ 109ê°œ ë£¬ ë°ì´í„°ëŠ” ì´ì „ ë‹µë³€ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ë¨) ...
             { "name": "ë§Œ ê°ˆë˜ ë¬¼ê¸¸", "grade": "ì‹ í™”", "type": "ë¬´ê¸°", "rank": "SS", "description": "ê³µê²©ë ¥ì´ 15% ì¦ê°€í•œë‹¤. í´ë˜ìŠ¤ ë ˆë²¨ 50ì„ ë‹¬ì„±í•  ë•Œë§ˆë‹¤ ì¶”ê°€ë¡œ ê³µê²©ë ¥ì´ 1%ì”© ì¦ê°€í•˜ë©° í•´ë‹¹ íš¨ê³¼ëŠ” ìµœëŒ€ 20íšŒê¹Œì§€ ì¤‘ì²©ëœë‹¤.(ëª¨ë“  í´ë˜ìŠ¤ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ìºë¦­í„°ê°€ ë‹¬ì„±í•œ í´ë˜ìŠ¤ ë ˆë²¨ ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íš¨ê³¼ ì ìš©)", "analysis": "ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê°•í•´ì§€ëŠ” ì„±ì¥í˜• ìµœì¢… ë£¬. ì—¬ëŸ¬ í´ë˜ìŠ¤ë¥¼ ìœ¡ì„±í• ìˆ˜ë¡ ìµœëŒ€ 35%ë¼ëŠ” ì••ë„ì ì¸ ê³µê²©ë ¥ì„ ì œê³µí•œë‹¤. ê³„ì •ì˜ ë‚´ì‹¤ì´ ê³§ ë£¬ì˜ ì„±ëŠ¥ì´ ë˜ëŠ”, ëª¨ë“  ìœ ì €ì˜ ìµœì¢… ëª©í‘œ.", "recommendedClasses": ["ì „ì‚¬ (ê²€ë°©)", "ì „ê²©ìˆ ì‚¬", "íëŸ¬", "ìŒìœ ì‹œì¸", "ì•…ì‚¬"] },
             { "name": "ì˜ì›…", "grade": "ì „ì„¤", "type": "ë¬´ê¸°", "rank": "S", "description": "ê³µê²©ë ¥, ì—°íƒ€ í”¼í•´, ê°•íƒ€ í”¼í•´, ì½¤ë³´ í”¼í•´, ìŠ¤í‚¬ í”¼í•´, ì¹˜ëª…íƒ€ í”¼í•´, ë©€í‹° íˆíŠ¸ í”¼í•´ê°€ ê°ê° 4.3% ì¦ê°€í•œë‹¤.", "analysis": "ê³µê²©ë ¥, ì—°íƒ€/ê°•íƒ€/ìŠ¤í‚¬/ì¹˜ëª…íƒ€ í”¼í•´ ë“± í•µì‹¬ ìŠ¤íƒ¯ì„ 30.1% ì˜¬ë ¤ì£¼ëŠ” ê³±ì—°ì‚° íš¨ìœ¨ì´ ë›°ì–´ë‚œ ë£¬ì…ë‹ˆë‹¤. ì–´ë–¤ ì„¸íŒ…ì—ì„œë„ ì•ˆì •ì ì¸ ë”œ ê¸°ëŒ€ê°’ì„ ë³´ì—¬ì£¼ëŠ” ì¼ëª… 'êµ­ë°¥' ë£¬ì…ë‹ˆë‹¤.", "recommendedClasses": ["ê²€ìˆ ì‚¬", "ê¶ìˆ˜", "ì„ê¶ì‚¬ìˆ˜", "ì¥ê¶ë³‘", "ë§ˆë²•ì‚¬", "í™”ì—¼ìˆ ì‚¬", "ë¹™ê²°ìˆ ì‚¬", "ì•”í‘ìˆ ì‚¬", "ëŒ„ì„œ", "ê²©íˆ¬ê°€", "ë“€ì–¼ ë¸”ë ˆì´ë“œ"] },
             // ... (ë‚˜ë¨¸ì§€ ìƒëµ) ...
             { "name": "ì¼ë ì´ëŠ” ë¶ˆê½ƒ", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "SS", "description": "ê³µê²© ì‹œ, ì¶”ê°€íƒ€ í™•ë¥ ì´ 15ì´ˆ ë™ì•ˆ 8/10% ì¦ê°€í•œë‹¤. ë³´ìœ í•œ ëª¨ë“  ì¶©ì „ì„ ì „ë ¥ìœ¼ë¡œ ë³€í™˜í•˜ê³ ...", "analysis": "<strong>[ê°•ë ¥ ì¶”ì²œ]</strong> <span class='text-blue-600'>[ìƒˆí¬ë¦¬ë§ˆ]</span> ë¹„ë¬¸í•™ì˜ ì •ì . ê²°ë¡ ì€ ìµœì¢… ë°ë¯¸ì§€ 30% ì¦ê°€. ë‹¨, 'ê°ˆë¼ì§„ ë•…' ì— ë¸”ëŸ¼ê³¼ëŠ” íš¨ìœ¨ ë‚˜ì¨.<br><span class='text-purple-600'>[1íƒ€ë²•ì‚¬]</span> íƒ€ìˆ˜ê°€ ë§ì€ ì§ì—…ì—ê²ŒëŠ” ì¢…ê²°ê¸‰ ì„±ëŠ¥.", "recommendedClasses": ["ì „ì‚¬ (ê²€ë°©)", "ê²€ìˆ ì‚¬", "ê¶ìˆ˜", "ì„ê¶ì‚¬ìˆ˜", "ì „ê²©ìˆ ì‚¬", "ì•”í‘ìˆ ì‚¬", "ë„ì ", "ë“€ì–¼ ë¸”ë ˆì´ë“œ"] },
             { "name": "ìš¸ë ¤í¼ì§€ëŠ” ì²œë‘¥", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "A", "description": "ê³µê²© ì‹œ ìŠ¤í‚¬ ì‚¬ìš© ì†ë„, ê³µê²© ì†ë„, ìºìŠ¤íŒ… ë° ì°¨ì§€ ì†ë„ê°€ 15ì´ˆ ë™ì•ˆ 6% ì¦ê°€í•œë‹¤...", "analysis": "<strong>[ì˜ê²¬ ëŒ€ë¦½]</strong> <span class='text-blue-600'>[ìƒˆí¬ë¦¬ë§ˆ]</span> ì“°ë ˆê¸°(ë–¡). ë”œ ìƒìŠ¹ì— ê¸°ì—¬í•˜ì§€ ëª»í•¨.<br><span class='text-purple-600'>[1íƒ€ë²•ì‚¬]</span> ë²•ì‚¬ ì¢…ê²° ê°€ëŠ¥ì„±. ìºìŠ¤íŒ…/ì°¨ì§€ ì†ë„ê°€ ì¤‘ìš”í•œ ë§ˆë²•ì‚¬ì—ê²Œ ê°€ì¹˜ ìˆìŒ.", "recommendedClasses": ["ë§ˆë²•ì‚¬", "ì „ê²©ìˆ ì‚¬", "ì‚¬ì œ"] },
             { "name": "ìœ ì„±", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "B", "description": "ê³µê²© ì‹œ, ì ì—ê²Œ (ê³µê²©ë ¥Ã—n%)ì˜ í”¼í•´ë¥¼ ì¤€ë‹¤. ë³´ìœ í•œ ëª¨ë“  ì¶©ì „ì„ ì „ë ¥ìœ¼ë¡œ ë³€í™˜í•˜ê³ ...", "analysis": "<strong>[ì¡°ê±´ë¶€ í‰ê°€]</strong> <span class='text-blue-600'>[ìƒˆí¬ë¦¬ë§ˆ]</span> ë²„ê·¸ ì›íˆ´. ë²„ê·¸ ìˆ˜ì • ì‹œ íê¸°ë¬¼.<br><span class='text-purple-600'>[1íƒ€ë²•ì‚¬]</span> ê·¼ì ‘ í´ë˜ìŠ¤ ì¶”ì²œ. ìƒìœ„ ì¸ì±ˆíŠ¸ ì‚¬ìš© ì‹œ ì§ì ‘ í”¼í•´ëŸ‰ì´ ì ì í•¨.", "recommendedClasses": ["ì „ì‚¬ (ê²€ë°©)", "ì „ì‚¬ (ëŒ€ê²€)", "ê²€ìˆ ì‚¬", "ê²©íˆ¬ê°€", "ë“€ì–¼ ë¸”ë ˆì´ë“œ"] },
             { "name": "ì´ˆì‹ ì„±", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "C", "description": "ê³µê²© ì‹œ, ì ì—ê²Œ (ê³µê²©ë ¥Ã—n%)ì˜ í”¼í•´ë¥¼ ì£¼ê³  15ì´ˆ ë™ì•ˆ ê³µê²©ë ¥ì´ 5% ì¦ê°€í•œë‹¤...", "analysis": "<span class='text-blue-600'>[ìƒˆí¬ë¦¬ë§ˆ]</span> ì„ì–´ì°Œê°œë¼ íš¨ìœ¨ ìµœì•….<br><span class='text-purple-600'>[1íƒ€ë²•ì‚¬]</span> ì›ê±°ë¦¬/íëŸ¬ ê³ ë ¤. ê³µì¦ê³¼ ë²”ìœ„ í”¼í•´ê°€ ê°™ì´ ìˆì–´ ê´œì°®ì„ ìˆ˜ ìˆìŒ.", "recommendedClasses": ["íëŸ¬", "ì‚¬ì œ", "ê¶ìˆ˜", "ì¥ê¶ë³‘"] },
             { "name": "ë²ˆê°œ ì±„ì°", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "C", "description": "ê³µê²© ì‹œ, ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ê°€ 15ì´ˆ ë™ì•ˆ 9/11% ì¦ê°€í•œë‹¤. ë³´ìœ í•œ ëª¨ë“  ì¶©ì „ì„ ì „ë ¥ìœ¼ë¡œ ë³€í™˜í•˜ê³ ...", "analysis": "<span class='text-blue-600'>[ìƒˆí¬ë¦¬ë§ˆ]</span> ì ìˆ˜ ì¤„ ê°€ì¹˜ ì—†ìŒ.<br><span class='text-purple-600'>[1íƒ€ë²•ì‚¬]</span> ì• ë§¤í•¨. ì´ë¯¸ ì¢‹ì€ í”¼ì¦ ë£¬ì´ ë§ì•„ ìš°ì„ ìˆœìœ„ ë–¨ì–´ì§.", "recommendedClasses": [] },
             { "name": "ê¸°ë³¸ê¸°", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "S", "description": "ê³µê²©ë ¥ì´ 15% ì¦ê°€í•œë‹¤.", "analysis": "ì¡°ê±´ ì—†ì´ ê³µê²©ë ¥ì„ 15% ì˜¬ë ¤ì£¼ëŠ” ì‹¬í”Œí•˜ê³  ê°•ë ¥í•œ ë£¬. ë²”ìš©ì ì¸ ì„¸íŒ…ì— ìµœì .", "recommendedClasses": [] },
             { "name": "ì••ë„ì ì¸ í˜", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "A", "description": "ê°•íƒ€ í”¼í•´ê°€ 6%, ê³µê²©ë ¥ì´ 6%, ì¹˜ëª…íƒ€ í™•ë¥ ì´ 4% ì¦ê°€í•œë‹¤. ì— ë¸”ëŸ¼ì˜ ê°ì„± íš¨ê³¼ê°€ í™œì„±í™”ë  ë•Œ, 20ì´ˆê°„ ì´ ë£¬ìœ¼ë¡œ ì¦ê°€í•œ ëŠ¥ë ¥ì¹˜ê°€ ë‘ë°°ê°€ ëœë‹¤.", "analysis": "ë‹¨ë… ì‚¬ìš© ì‹œ Aê¸‰. 8ì„± ì— ë¸”ëŸ¼ê³¼ ëˆˆ ë¨¼ ì˜ˆì–¸ì ë£¬ê³¼ ì¡°í•©ë  ê²½ìš° 20ì´ˆê°„ SSSê¸‰ìœ¼ë¡œ ë³€ëª¨í•˜ëŠ” í­ë°œì ì¸ ì ì¬ë ¥ì„ ê°€ì¡Œë‹¤. ê°•íƒ€ ë¹Œë“œì˜ í­ë”œ íƒ€ì„ì„ ì±…ì„ì§€ëŠ” í•µì‹¬ íŒŒì¸ .", "recommendedClasses": ["ì „ì‚¬ (ê²€ë°©)", "ì „ì‚¬ (ëŒ€ê²€)", "ê²€ìˆ ì‚¬", "ê¶ìˆ˜", "ì„ê¶ì‚¬ìˆ˜", "ì¥ê¶ë³‘", "ë§ˆë²•ì‚¬", "í™”ì—¼ìˆ ì‚¬", "ë¹™ê²°ìˆ ì‚¬", "ì „ê²©ìˆ ì‚¬", "ì‚¬ì œ", "ìˆ˜ë„ì‚¬", "ì•”í‘ìˆ ì‚¬", "ìŒìœ ì‹œì¸", "ì•…ì‚¬", "ëŒ„ì„œ", "ë„ì ", "ê²©íˆ¬ê°€", "ë“€ì–¼ ë¸”ë ˆì´ë“œ"] },
             { "name": "ì„¬ì„¸í•œ ì†ë†€ë¦¼", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "A", "description": "ì—°íƒ€ í”¼í•´ê°€ 6%, ê³µê²©ë ¥ì´ 6%, ì¶”ê°€íƒ€ í™•ë¥ ì´ 4% ì¦ê°€í•œë‹¤. ì— ë¸”ëŸ¼ì˜ ê°ì„± íš¨ê³¼ê°€ í™œì„±í™”ë  ë•Œ, 20ì´ˆê°„ ì´ ë£¬ìœ¼ë¡œ ì¦ê°€í•œ ëŠ¥ë ¥ì¹˜ê°€ ë‘ë°°ê°€ ëœë‹¤.", "analysis": "'ì••ë„ì ì¸ í˜'ì˜ ì—°íƒ€ ë²„ì „. ë‹¨ë… ì„±ëŠ¥ì€ Aê¸‰ì´ì§€ë§Œ, 8ì„± ì— ë¸”ëŸ¼ê³¼ ëˆˆ ë¨¼ ì˜ˆì–¸ì ë£¬ê³¼ ì¡°í•© ì‹œ 20ì´ˆê°„ SSSê¸‰ ë”œë§ì„ ë³´ì¥í•œë‹¤. ì—°íƒ€ ìœ„ì£¼ ì§ì—…êµ°ì´ ê°ì„± íƒ€ì´ë°ì— ë§ì¶° í­ë”œì„ ë„£ì„ ë•Œ í•„ìˆ˜ì ì¸ ë£¬.", "recommendedClasses": ["ì „ì‚¬ (ê²€ë°©)", "ì „ì‚¬ (ëŒ€ê²€)", "ê²€ìˆ ì‚¬", "ê¶ìˆ˜", "ì„ê¶ì‚¬ìˆ˜", "ì¥ê¶ë³‘", "ë§ˆë²•ì‚¬", "í™”ì—¼ìˆ ì‚¬", "ë¹™ê²°ìˆ ì‚¬", "ì „ê²©ìˆ ì‚¬", "ì‚¬ì œ", "ìˆ˜ë„ì‚¬", "ì•”í‘ìˆ ì‚¬", "ìŒìœ ì‹œì¸", "ì•…ì‚¬", "ëŒ„ì„œ", "ë„ì ", "ê²©íˆ¬ê°€", "ë“€ì–¼ ë¸”ë ˆì´ë“œ"] },
             { "name": "ë¶€ì„œì§„ í•˜ëŠ˜", "grade": "ì „ì„¤", "type": "ì— ë¸”ëŸ¼", "rank": "SSS", "description": "ê³µê²© ì‹œ 50% í™•ë¥ ë¡œ ê°ì„±í•˜ì—¬ 20ì´ˆ ë™ì•ˆ ì—°íƒ€ í”¼í•´ê°€ 60% ì¦ê°€í•œë‹¤. ìƒì‹œ íš¨ê³¼: ì—°íƒ€ í”¼í•´ 8%, ì¿¨íšŒë³µ 8% ì¦ê°€.", "analysis": "ê²€ìˆ ì‚¬ì—ê²ŒëŠ” SSSê¸‰, ê·¸ ì™¸ ì—°íƒ€ ê¸°ë°˜ ì§ì—…êµ°ì—ê²ŒëŠ” Sê¸‰ ì„±ëŠ¥ì„ ë³´ì—¬ì£¼ëŠ” ìµœìƒê¸‰ ë£¬.", "recommendedClasses": [] },
             { "name": "ê²€ë¬´+", "grade": "ì „ì„¤", "type": "ë¬´ê¸°", "rank": "SS", "description": "ëˆ„ì : ê³µê²© ì ì¤‘ ì‹œ ê³µ 2%, ì¹˜í™• 1% ì¦ê°€ (ìµœëŒ€ 10íšŒ).", "analysis": "ìŠ¤íƒ ìœ ì§€ ì‹œ ìµœëŒ€ ê³µê²©ë ¥ 20%, ì¹˜ëª…íƒ€ í™•ë¥  10% ì¦ê°€. ê³µìˆ˜ ë°¸ëŸ°ìŠ¤ê°€ ë›°ì–´ë‚˜ ë²”ìš©ì„±ì´ ë§¤ìš° ë†’ë‹¤.", "recommendedClasses": ["ê²€ìˆ ì‚¬", "ê¶ìˆ˜", "ì„ê¶ì‚¬ìˆ˜", "ì¥ê¶ë³‘", "ë§ˆë²•ì‚¬", "í™”ì—¼ìˆ ì‚¬"] },
             { "name": "ì§€íœ˜ê´€", "grade": "ì „ì„¤", "type": "ë°©ì–´êµ¬", "rank": "B", "description": "ê°•íƒ€, ì—°íƒ€, ë¬´ë°©ë¹„, ì¹˜ëª…íƒ€, ì¶”ê°€íƒ€ ê³µê²© ì‹œ, 8ì´ˆ ë™ì•ˆ ê³µê²©ë ¥ì´ 4.5% ì¦ê°€í•˜ë©°, í•´ë‹¹ íš¨ê³¼ëŠ” ìµœëŒ€ 5íšŒê¹Œì§€ ì¤‘ì²©ëœë‹¤. ê° ê³µê²©ë ¥ ì¦ê°€ íš¨ê³¼ëŠ” ë³„ë„ì˜ ì§€ì† ì‹œê°„ì„ ê°€ì§„ë‹¤.", "analysis": "ìµœëŒ€ ìŠ¤íƒ ì‹œ ê³µê²©ë ¥ 22.5%ëŠ” ì¤€ìˆ˜í•˜ì§€ë§Œ, ìƒìœ„ í˜¸í™˜ ë£¬ë“¤ì´ ë§ì•„ì§€ë©´ì„œ Bê¸‰ìœ¼ë¡œ í‰ê°€ê°€ ë‚´ë ¤ì™”ë‹¤.", "recommendedClasses": [] }
             // (ì´ì „ ë‹µë³€ì˜ ì „ì²´ ë¦¬ìŠ¤íŠ¸ë¥¼ ì´ê³³ì— ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤. ë¶„ëŸ‰ìƒ ìƒëµëœ ë¶€ë¶„ì€ í•„íˆ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.)
        ];

        document.addEventListener('DOMContentLoaded', () => {
             // --- TAB LOGIC ---
            const tabRune = document.getElementById('tab-rune');
            const tabRaid = document.getElementById('tab-raid');
            const secRune = document.getElementById('section-rune-browser');
            const secRaid = document.getElementById('section-raid-builder');

            tabRune.addEventListener('click', () => {
                secRune.classList.remove('hidden');
                secRaid.classList.add('hidden');
                tabRune.className = "tab-active inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors cursor-pointer";
                tabRaid.className = "tab-inactive inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors cursor-pointer";
            });

            tabRaid.addEventListener('click', () => {
                secRune.classList.add('hidden');
                secRaid.classList.remove('hidden');
                tabRune.className = "tab-inactive inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors cursor-pointer";
                tabRaid.className = "tab-active inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors cursor-pointer";
            });

            // --- RUNE BROWSER LOGIC ---
            const gradeFilter = document.getElementById('grade-filter');
            const classFilter = document.getElementById('class-filter');
            const typeFilter = document.getElementById('type-filter');
            const rankFilter = document.getElementById('rank-filter');
            const searchInput = document.getElementById('search-input');
            const resetBtn = document.getElementById('reset-filters');
            const runeGrid = document.getElementById('rune-grid');
            const runeCountSpan = document.getElementById('rune-count');
            
            const rankOrder = ["SSS", "SS", "S", "A+", "A", "B", "C", "F", "TBD"];
            const allClassNames = [...new Set(runeData.flatMap(r => r.recommendedClasses))].sort((a, b) => a.localeCompare(b, 'ko'));

            function getRankClass(rank) {
                if (rank.includes('/')) return 'rank-A-Plus';
                if (rank === "A+") return 'rank-A-Plus';
                return `rank-${rank}`; 
            }
            function getTypeClass(type) { return `type-${type}`; }
            function getGradeClass(grade) { return `grade-${grade}`; }

            function setupFilters() {
                const grades = [...new Set(runeData.map(r => r.grade))];
                const types = [...new Set(runeData.map(r => r.type))];
                const ranks = [...new Set(runeData.map(r => r.rank.split('/')[0]))]
                    .filter((v, i, a) => a.indexOf(v) === i)
                    .sort((a, b) => rankOrder.indexOf(a) - rankOrder.indexOf(b));

                grades.forEach(grade => {
                    const option = document.createElement('option');
                    option.value = grade;
                    option.textContent = grade;
                    gradeFilter.appendChild(option);
                });
                 
                types.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    typeFilter.appendChild(option);
                });

                ranks.forEach(rank => {
                    const option = document.createElement('option');
                    option.value = rank;
                    option.textContent = rank;
                    rankFilter.appendChild(option);
                });

                allClassNames.forEach(className => {
                    const option = document.createElement('option');
                    option.value = className;
                    option.textContent = className;
                    classFilter.appendChild(option);
                });
            }

            function createRuneCard(rune) {
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-lg p-6 transform hover:-translate-y-1 transition-transform duration-300 border border-gray-100";
                
                let analysisText = rune.analysis;
                if (rune.recommendedClasses && rune.recommendedClasses.length > 0) {
                     analysisText += `<br><br><strong class="text-indigo-600">[ì¶”ì²œ í´ë˜ìŠ¤: ${rune.recommendedClasses.join(', ')}]</strong>`;
                }

                card.innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 flex flex-col space-y-3">
                            <h2 class="text-2xl font-bold text-gray-800">${rune.name}</h2>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-xs font-bold py-1 px-3 rounded-full ${getTypeClass(rune.type)}">${rune.type}</span>
                                <span class="text-xs font-bold border-2 ${getGradeClass(rune.grade)} py-1 px-3 rounded-full">${rune.grade}</span>
                            </div>
                            <div>
                                <span class="text-xl font-bold py-2 px-5 rounded-full ${getRankClass(rune.rank)}">${rune.rank}</span>
                            </div>
                        </div>
                        <div class="lg:col-span-2 space-y-4">
                            <div>
                                <h4 class="font-bold text-gray-700 mb-2 border-b-2 border-gray-200 pb-1">íš¨ê³¼ ì„¤ëª…</h4>
                                <p class="text-base text-gray-600">${rune.description}</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-700 mb-2 border-b-2 border-gray-200 pb-1">ì „ë¬¸ê°€ ë¶„ì„</h4>
                                <p class="text-base text-gray-800">${analysisText}</p>
                            </div>
                        </div>
                    </div>
                `;
                return card;
            }

            function renderRunes() {
                const grade = gradeFilter.value;
                const className = classFilter.value;
                const type = typeFilter.value;
                const rank = rankFilter.value;
                const searchTerm = searchInput.value.toLowerCase();

                const filteredData = runeData.filter(rune => {
                    const gradeMatch = grade === 'all' || rune.grade === grade;
                    const typeMatch = type === 'all' || rune.type === type;
                    const rankMatch = rank === 'all' || rune.rank.startsWith(rank);
                    const classMatch = className === 'all' || (rune.recommendedClasses && rune.recommendedClasses.includes(className));
                    const searchMatch = rune.name.toLowerCase().includes(searchTerm) || 
                                        rune.analysis.toLowerCase().includes(searchTerm) || 
                                        rune.description.toLowerCase().includes(searchTerm);
                    return gradeMatch && typeMatch && rankMatch && classMatch && searchMatch;
                });
                
                const sortedData = filteredData.sort((a,b) => {
                    const rankA = a.rank.split('/')[0];
                    const rankB = b.rank.split('/')[0];
                    const rankComparison = rankOrder.indexOf(rankA) - rankOrder.indexOf(rankB);
                    if (rankComparison !== 0) return rankComparison;
                    return a.name.localeCompare(b.name, 'ko');
                });

                runeGrid.innerHTML = '';
                sortedData.forEach(rune => {
                    runeGrid.appendChild(createRuneCard(rune));
                });
                runeCountSpan.textContent = sortedData.length;
            }

            gradeFilter.addEventListener('change', renderRunes);
            classFilter.addEventListener('change', renderRunes);
            typeFilter.addEventListener('change', renderRunes);
            rankFilter.addEventListener('change', renderRunes);
            searchInput.addEventListener('input', renderRunes);
            resetBtn.addEventListener('click', () => {
                gradeFilter.value = 'all'; classFilter.value = 'all'; typeFilter.value = 'all'; rankFilter.value = 'all'; searchInput.value = '';
                renderRunes();
            });
            
            setupFilters();
            renderRunes();
        });
    </script>
</body>
</html>
